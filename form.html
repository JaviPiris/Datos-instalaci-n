<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Datos de Instalación</title>
    <!-- Incluye Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Color de fondo suave */
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 sm:p-8 md:p-10 border border-gray-200">
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-6 text-center">Datos de Instalación</h1>
        <p class="text-gray-600 mb-8 text-center">Por favor, rellena todos los campos requeridos para la instalación.</p>

        <!-- Se ha añadido un ID al formulario para poder manejarlo con JavaScript -->
        <!-- Los atributos 'action' y 'method' se gestionarán con JavaScript (fetch) -->
        <form id="installationForm">
            <!-- Sección: Dirección completa de instalación -->
            <div class="mb-8 p-6 bg-blue-50 rounded-lg border border-blue-200">
                <h2 class="text-2xl font-semibold text-blue-700 mb-4">Dirección Completa de Instalación</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="tipoVia" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Vía</label>
                        <select id="tipoVia" name="tipoVia" required
                                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out appearance-none">
                            <option value="">Selecciona</option>
                            <option value="calle">Calle</option>
                            <option value="avenida">Avenida</option>
                            <option value="plaza">Plaza</option>
                            <option value="paseo">Paseo</option>
                            <option value="carretera">Carretera</option>
                            <option value="via">Vía</option>
                            <option value="ronda">Ronda</option>
                            <option value="bulevar">Bulevar</option>
                            <option value="camino">Camino</option>
                            <option value="urbanizacion">Urbanización</option>
                            <option value="glorieta">Glorieta</option>
                            <option value="pasaje">Pasaje</option>
                            <option value="rambla">Rambla</option>
                            <option value="travesia">Travesía</option>
                            <option value="cuesta">Cuesta</option>
                            <option value="barrio">Barrio</option>
                            <option value="poligono">Polígono Industrial</option>
                        </select>
                    </div>
                    <div>
                        <label for="nombreVia" class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Vía</label>
                        <input type="text" id="nombreVia" name="nombreVia" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="numero" class="block text-sm font-medium text-gray-700 mb-1">Número</label>
                        <input type="text" id="numero" name="numero" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="bloquePortal" class="block text-sm font-medium text-gray-700 mb-1">Bloque / Portal (opcional)</label>
                        <input type="text" id="bloquePortal" name="bloquePortal"
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="poblacionLocalidad" class="block text-sm font-medium text-gray-700 mb-1">Población / Localidad</label>
                        <input type="text" id="poblacionLocalidad" name="poblacionLocalidad" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="provincia" class="block text-sm font-medium text-gray-700 mb-1">Provincia</label>
                        <input type="text" id="provincia" name="provincia" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </div>
            </div>

            <!-- Sección: Datos de la comunidad de propietarios / empresa -->
            <div class="mb-8 p-6 bg-green-50 rounded-lg border border-green-200">
                <h2 class="text-2xl font-semibold text-green-700 mb-4">Datos de la Comunidad de Propietarios / Empresa</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="denominacionNombre" class="block text-sm font-medium text-gray-700 mb-1">Denominación / Nombre (presidente)</label>
                        <input type="text" id="denominacionNombre" name="denominacionNombre" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="cif" class="block text-sm font-medium text-gray-700 mb-1">C.I.F.</label>
                        <input type="text" id="cif" name="cif" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm">
                    </div>
                </div>
            </div>

            <!-- Sección: Datos de contacto a efectos administrativos y de facturación -->
            <div class="mb-8 p-6 bg-yellow-50 rounded-lg border border-yellow-200">
                <h2 class="text-2xl font-semibold text-yellow-700 mb-4">Datos de Contacto (Administrativos y Facturación)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="contactoAAFF" class="block text-sm font-medium text-gray-700 mb-1">AAFF o Persona de Contacto</label>
                        <input type="text" id="contactoAAFF" name="contactoAAFF" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="direccionContacto" class="block text-sm font-medium text-gray-700 mb-1">Dirección Completa de Contacto</label>
                        <input type="text" id="direccionContacto" name="direccionContacto" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm">
                    </div>
                    <div class="md:col-span-2">
                        <label for="emailContacto" class="block text-sm font-medium text-gray-700 mb-1">Email de Contacto</label>
                        <input type="email" id="emailContacto" name="emailContacto" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm">
                    </div>
                </div>
                <div class="mt-6 p-4 bg-yellow-100 rounded-md border border-yellow-300">
                    <h3 class="lg font-medium text-yellow-800 mb-3">Datos Bancarios (SEPA)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="titularCuenta" class="block text-sm font-medium text-gray-700 mb-1">Titular de la Cuenta</label>
                            <input type="text" id="titularCuenta" name="titularCuenta" required
                                   class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="banco" class="block text-sm font-medium text-gray-700 mb-1">Banco</label>
                            <input type="text" id="banco" name="banco" required
                                   class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="iban" class="block text-sm font-medium text-gray-700 mb-1">IBAN</label>
                            <input type="text" id="iban" name="iban" required pattern="[A-Z]{2}[0-9]{2}[A-Z0-9]{12,30}" title="Formato IBAN: ESXX XXXX XXXX XXXX XXXX XXXX"
                                   class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm placeholder-gray-400"
                                   placeholder="ESXX XXXX XXXX XXXX XXXX XXXX">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección: Datos del instalador y fecha de instalación -->
            <div class="mb-8 p-6 bg-purple-50 rounded-lg border border-purple-200">
                <h2 class="text-2xl font-semibold text-purple-700 mb-4">Información del Instalador y Cita</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="tlfInstalador" class="block text-sm font-medium text-gray-700 mb-1">Nº de Teléfono del Instalador</label>
                        <input type="tel" id="tlfInstalador" name="tlfInstalador" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="fechaInstalacion" class="block text-sm font-medium text-gray-700 mb-1">Fecha de Instalación</label>
                        <input type="date" id="fechaInstalacion" name="fechaInstalacion" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="horaInstalacion" class="block text-sm font-medium text-gray-700 mb-1">Hora de Instalación</label>
                        <input type="time" id="horaInstalacion" name="horaInstalacion" required
                               class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm">
                    </div>
                    <div class="md:col-span-2">
                        <div class="flex items-center">
                            <input id="normoApp" name="normoApp" type="checkbox"
                                   class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                            <label for="normoApp" class="ml-2 block text-sm font-medium text-gray-700">El instalador se ha descargado y registrado en la app de Normo</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Área para mostrar mensajes de confirmación o error -->
            <div id="formMessage" class="mt-4 p-3 rounded-md text-center hidden"></div>

            <!-- Botón de Envío -->
            <div class="mt-10 text-center">
                <button type="submit"
                        class="inline-flex justify-center py-3 px-8 border border-transparent shadow-sm text-lg font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-300 ease-in-out transform hover:scale-105">
                    Enviar Formulario
                </button>
            </div>
        </form>
    </div>

    <script>
        // ¡IMPORTANTE! Reemplaza esta URL con la URL de tu Web App de Google Apps Script
        const GOOGLE_APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzzPx0diQcFHQ9fPxUXDqY91_Lceq9UhbRNwO0SZzQh8KGsx2URvBlpe4YO-sgSbAcD/exec'; 

        const form = document.getElementById('installationForm');
        const formMessage = document.getElementById('formMessage');

        form.addEventListener('submit', async (event) => {
            event.preventDefault(); // Previene el envío tradicional del formulario

            // Muestra un mensaje de carga
            formMessage.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            formMessage.classList.add('bg-blue-100', 'text-blue-700');
            formMessage.textContent = 'Enviando datos... Por favor, espera.';

            const formData = new FormData(form);

            try {
                const response = await fetch(GOOGLE_APP_SCRIPT_URL, {
                    method: 'POST',
                    body: formData // Envía los datos directamente como FormData
                });

                if (response.ok) {
                    const resultText = await response.text(); // El script de Apps Script devuelve texto
                    formMessage.classList.remove('bg-blue-100', 'text-blue-700', 'bg-red-100', 'text-red-700');
                    formMessage.classList.add('bg-green-100', 'text-green-700');
                    formMessage.textContent = '¡Formulario enviado con éxito! Los datos han sido guardados. ' + resultText;
                    formMessage.classList.remove('hidden');
                    form.reset(); // Limpia los campos del formulario
                } else {
                    const errorText = await response.text();
                    throw new Error(`Error al enviar el formulario: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('Error al enviar el formulario:', error);
                formMessage.classList.remove('bg-blue-100', 'text-blue-700', 'bg-green-100', 'text-green-700');
                formMessage.classList.add('bg-red-100', 'text-red-700');
                formMessage.textContent = 'Error al enviar el formulario. Por favor, inténtalo de nuevo. Detalle: ' + error.message;
                formMessage.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
